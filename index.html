<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Smart Controller</title>

<style>
body{
  margin:0;
  background:#f3f4f6;
  font-family:Arial;
}
.header{
  background:#4f46e5;
  padding:15px;
  color:#fff;
  text-align:center;
  font-size:20px;
}

/* Tabs */
.tab-btn{
  width:100%;
  padding:15px;
  font-size:18px;
  text-align:left;
  background:#fff;
  border:none;
  border-bottom:1px solid #ddd;
  cursor:pointer;
}
.tab-btn:hover{background:#f9fafb;}

.panel{
  max-height:0;
  overflow:hidden;
  transition:max-height .3s ease;
  background:#fff;
  padding:0 15px;
}

.section-title{
  padding-top:15px;
  font-size:17px;
  font-weight:bold;
}

.card{
  background:#fff;
  padding:15px;
  margin:10px 0;
  border-radius:10px;
  box-shadow:0 2px 5px rgba(0,0,0,.1);
}

.relay-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 0;
}

.relay-btn{
  padding:7px 15px;
  background:#4f46e5;
  border:none;
  color:#fff;
  border-radius:8px;
  cursor:pointer;
}
.relay-btn.off{
  background:#ef4444;
}

.status-online{color:#22c55e;font-weight:bold;}
.status-offline{color:#ef4444;font-weight:bold;}
.sensor-ok{color:#3b82f6;font-weight:bold;}
.sensor-bad{color:#ef4444;font-weight:bold;}

.input-box{
  width:90%;
  padding:8px;
  margin-top:5px;
  border:1px solid #ccc;
  border-radius:6px;
}
.save-btn{
  margin:10px 0;
  padding:10px 20px;
  background:#4f46e5;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="header">Smart Controller Dashboard</div>

<!-- ============ TAB BUTTONS ============ -->
<button class="tab-btn" onclick="togglePanel('relayPanel')">Relay Control</button>
<div id="relayPanel" class="panel">
  
  <div class="card">
    <div class="relay-row">
      <span>Relay 1</span>
      <button class="relay-btn" id="r1btn" onclick="toggleRelay(1)">Toggle</button>
    </div>
    <div class="relay-row">
      <span>Relay 2</span>
      <button class="relay-btn" id="r2btn" onclick="toggleRelay(2)">Toggle</button>
    </div>
    <div class="relay-row">
      <span>Relay 3</span>
      <button class="relay-btn" id="r3btn" onclick="toggleRelay(3)">Toggle</button>
    </div>
  </div>

</div>

<button class="tab-btn" onclick="togglePanel('tempPanel')">Temperature & Humidity</button>
<div id="tempPanel" class="panel">

  <div class="card">
    <div class="section-title">Device Status</div>
    <div id="deviceStatus">Checking...</div>

    <div class="section-title">Sensor Status</div>
    <div id="sensorStatus">Checking...</div>

    <div class="section-title">Temperature</div>
    <div id="tempValue">-- °C</div>

    <div class="section-title">Humidity</div>
    <div id="humiValue">-- %</div>
  </div>

</div>

<button class="tab-btn" onclick="togglePanel('timerPanel')">Normal Timer</button>
<div id="timerPanel" class="panel">

  <div class="card">
    <div class="section-title">Relay Select</div>
    <select class="input-box" id="timerRelay">
      <option value="relay1">Relay 1</option>
      <option value="relay2">Relay 2</option>
      <option value="relay3">Relay 3</option>
    </select>

    <div class="section-title">Timer (Seconds)</div>
    <input type="number" class="input-box" id="timerSeconds" placeholder="Enter seconds">

    <button class="save-btn" onclick="setTimer()">Save Timer</button>
  </div>

</div>

<button class="tab-btn" onclick="togglePanel('weeklyPanel')">Weekly Timer</button>
<div id="weeklyPanel" class="panel">

  <div class="card">
    <div class="section-title">Relay Select</div>
    <select class="input-box" id="weeklyRelay">
      <option value="relay1">Relay 1</option>
      <option value="relay2">Relay 2</option>
      <option value="relay3">Relay 3</option>
    </select>

    <div class="section-title">Day</div>
    <select class="input-box" id="daySelect">
      <option>Monday</option>
      <option>Tuesday</option>
      <option>Wednesday</option>
      <option>Thursday</option>
      <option>Friday</option>
      <option>Saturday</option>
      <option>Sunday</option>
    </select>

    <div class="section-title">ON Time</div>
    <input type="time" class="input-box" id="onTime">

    <div class="section-title">OFF Time</div>
    <input type="time" class="input-box" id="offTime">

    <button class="save-btn" onclick="saveWeekly()">Save Weekly Slot</button>
  </div>

</div>

<!-- ============ FIREBASE ============ -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>

// ⭐⭐⭐ INSERT YOUR FIREBASE CONFIG HERE ⭐⭐⭐
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.database();

/* ------------------ TABS ------------------- */
function togglePanel(id){
  let p = document.getElementById(id);
  if(p.style.maxHeight){
    p.style.maxHeight = null;
  } else {
    p.style.maxHeight = p.scrollHeight + "px";
  }
}

/* ------------------ RELAY CONTROL ------------------- */
function toggleRelay(n){
  let path = "device/relay" + n;
  db.ref(path).once("value", snap=>{
    let v = snap.val() == 1 ? 0 : 1;
    db.ref(path).set(v);
  });
}

db.ref("device").on("value", snap=>{
  let d = snap.val();

  document.getElementById("r1btn").classList.toggle("off", d.relay1==0);
  document.getElementById("r2btn").classList.toggle("off", d.relay2==0);
  document.getElementById("r3btn").classList.toggle("off", d.relay3==0);

  /* --------- temperature / humidity ---------- */
  if(d.lastUpdate){
    let age = Date.now() - d.lastUpdate;
    if(age < 10000){
      document.getElementById("deviceStatus").innerHTML = "<span class='status-online'>ONLINE</span>";
    } else {
      document.getElementById("deviceStatus").innerHTML = "<span class='status-offline'>OFFLINE</span>";
    }
  }

  if(d.temperature == null || d.humidity == null){
    document.getElementById("sensorStatus").innerHTML = "<span class='sensor-bad'>NOT CONNECTED</span>";
  } else {
    document.getElementById("sensorStatus").innerHTML = "<span class='sensor-ok'>CONNECTED</span>";
  }

  document.getElementById("tempValue").innerHTML = d.temperature ? d.temperature + " °C" : "-- °C";
  document.getElementById("humiValue").innerHTML = d.humidity ? d.humidity + " %" : "-- %";

});

/* ------------------ NORMAL TIMER ------------------- */
function setTimer(){
  let relay = document.getElementById("timerRelay").value;
  let sec = Number(document.getElementById("timerSeconds").value);

  if(sec <= 0){ alert("Enter valid seconds"); return; }

  db.ref("device/timer/"+relay).set({
    enable: true,
    seconds: sec
  });

  alert("Timer Saved!");
}

/* ------------------ WEEKLY TIMER ------------------- */
function saveWeekly(){
  let relay = document.getElementById("weeklyRelay").value;
  let day = document.getElementById("daySelect").value;
  let onT = document.getElementById("onTime").value;
  let offT = document.getElementById("offTime").value;

  if(!onT || !offT){ alert("Enter time"); return; }

  db.ref("device/weekly/"+relay+"/"+day).set({
    on: onT,
    off: offT
  });

  alert("Weekly Slot Saved!");
}

</script>

</body>
</html>
