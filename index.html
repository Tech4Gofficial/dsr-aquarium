<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AC Control Dashboard</title>
<style>
    body { font-family: Arial; margin: 0; background:#f4f4f4; }
    .container { width: 95%; max-width: 500px; margin: auto; padding-top: 20px; }

    .card {
        background: #fff; padding: 15px; border-radius: 10px; 
        box-shadow: 0 2px 5px rgba(0,0,0,0.2); margin-bottom: 12px;
    }

    h2 { margin-top: 0; }

    .status-online { color: green; font-weight: bold; }
    .status-offline { color: red; font-weight: bold; }

    .tab {
        background:#eee; padding: 10px; border-radius: 8px;
        cursor:pointer; margin-bottom:5px; font-weight:bold;
    }
    .tabContent { display:none; padding:10px; background:#fff; border-radius:8px; }

    input, select, button { 
        width: 100%; padding:10px; margin-top:8px; font-size:16px;
        border-radius:6px; border:1px solid #ccc;
    }

    button { background:#007bff; color:#fff; border:none; }
</style>
</head>

<body>
<div class="container">

    <h2>AC Control Panel</h2>

    <!-- DEVICE STATUS -->
    <div class="card">
        <h3>Device Status:</h3>
        <p id="deviceStatus">Checking...</p>
        <p id="sensorStatus">Checking...</p>
    </div>

    <!-- SENSOR DATA -->
    <div class="card">
        <h3>Temperature & Humidity</h3>
        <p>Temperature: <span id="temp">--</span> Â°C</p>
        <p>Humidity: <span id="hum">--</span> %</p>
    </div>

    <!-- CONTROL TAB -->
    <div class="tab" onclick="toggleTab('controlTab')">Manual Control</div>
    <div id="controlTab" class="tabContent">
        <button onclick="sendCommand('ON')">Turn ON</button>
        <button onclick="sendCommand('OFF')" style="background:#d9534f;">Turn OFF</button>
    </div>

    <!-- TIMER TAB -->
    <div class="tab" onclick="toggleTab('timerTab')">Timer Settings</div>
    <div id="timerTab" class="tabContent">

        <h3>Add Timer</h3>
        <label>ON Time:</label>
        <input type="time" id="onTime">

        <label>OFF Time:</label>
        <input type="time" id="offTime">

        <button onclick="addTimer()">Save Timer</button>

        <h3>Saved Timers</h3>
        <div id="timerList">Loading...</div>
    </div>
</div>

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js"></script>

<script>
// ------------------------------------------------------------
//       ðŸ”¥ ENTER YOUR FIREBASE DETAILS HERE
// ------------------------------------------------------------
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_DOMAIN",
    databaseURL: "YOUR_FIREBASE_DB_URL",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_BUCKET",
    messagingSenderId: "MSG_ID",
    appId: "APP_ID"
};
// ------------------------------------------------------------

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ðŸ”¹ Toggle Tab
function toggleTab(id) {
    let x = document.getElementById(id);
    x.style.display = (x.style.display === "block") ? "none" : "block";
}

// ðŸ”¹ Send ON/OFF Command
function sendCommand(cmd) {
    firebase.database().ref("AC/Command").set(cmd);
}

// ðŸ”¹ Add Timer
function addTimer() {
    let onTime = document.getElementById("onTime").value;
    let offTime = document.getElementById("offTime").value;

    if (!onTime || !offTime) {
        alert("Please select both times");
        return;
    }

    let id = Date.now();
    firebase.database().ref("AC/Timers/" + id).set({
        on: onTime,
        off: offTime
    });

    alert("Timer Added");
}

// ðŸ”¹ Load Timers
firebase.database().ref("AC/Timers").on("value", snap => {
    let data = snap.val();
    let html = "";

    if (!data) {
        html = "No timers saved";
    } else {
        for (let id in data) {
            html += `<div class='card'>
                <p>ON: ${data[id].on}</p>
                <p>OFF: ${data[id].off}</p>
                <button onclick="deleteTimer('${id}')">Delete</button>
            </div>`;
        }
    }

    document.getElementById("timerList").innerHTML = html;
});

// ðŸ”¹ Delete Timer
function deleteTimer(id) {
    firebase.database().ref("AC/Timers/" + id).remove();
}

// ðŸ”¹ Read Temperature & Humidity
firebase.database().ref("AC/Sensor").on("value", snap => {
    let d = snap.val();
    if (!d) return;

    document.getElementById("temp").textContent = d.temp ?? "--";
    document.getElementById("hum").textContent = d.hum ?? "--";

    document.getElementById("sensorStatus").innerHTML =
        (d.connected ? "<span class='status-online'>Sensor Connected</span>"
                     : "<span class='status-offline'>Sensor Disconnected</span>");
});

// ðŸ”¹ Device Online/Offline check
firebase.database().ref("AC/Status").on("value", snap => {
    let isOnline = snap.val();
    document.getElementById("deviceStatus").innerHTML =
        isOnline ? "<span class='status-online'>Online</span>"
                 : "<span class='status-offline'>Offline</span>";
});
</script>

</body>
</html>
